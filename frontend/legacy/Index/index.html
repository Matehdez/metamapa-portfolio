<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>MetaMapa</title>

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Basics -->
    <link rel="stylesheet" href="../shared/tokens.css">
    <link rel="stylesheet" href="../shared/base.css">
    <link rel="stylesheet" href="../shared/components.css">
    <link rel="stylesheet" href="../shared/utilities.css">

    <!-- Estilos -->
    <link rel="stylesheet" href="../shared/nav.css"/>
    <link rel="stylesheet" href="../shared/icons.css"/>
    <link rel="stylesheet" href="../shared/filters.css"/>
    <link rel="stylesheet" href="../shared/Map/map.css"/>
    <link rel="stylesheet" href="../shared/featuredCollections.css"/>


    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <!-- Estilos propios -->
    <link rel="stylesheet" href="indexCSS.css"/>
</head>

<body>

<!-- Header -->
<header class="navbar" id="navbar">
    <div class="brand">
        <div class="brand-mark"><span class="dot"></span></div>
        <span class="brand-name">MetaMapa</span>
    </div>

    <div class="auth-actions">
        <button id="accountBtn" class="account-btn" type="button" data-auth="open"
                data-panel="register">Registrarse
        </button>
        <button id="loginBtn" class="btn-outline" type="button" data-auth="open" data-panel="login">Iniciar
            Sesi√≥n
        </button>
    </div>

</header>

<nav class="subnav" id="subnav">
    <a href="index.html" class="active">Explorar</a>
    <a href="../Collections/collections.html">Colecciones</a>
    <a href="../map/mapa.html">Mapa</a>

</nav>


<!-- Layout principal -->
<main class="layout">
    <!-- Sidebar izquierda -->
    <aside class="sidebar card">
        <h3>Filtros</h3>

        <!-- Form GET para que el backend aplique filtros -->
        <form class="filters" method="get" action="">

            <!-- CATEGOR√çA -->
            <details class="flt">
                <summary class="flt-head">
                    <span class="flt-title">Categor√≠a</span>
                    <span class="caret" aria-hidden="true">‚ñæ</span>
                </summary>

                <div class="flt-body">
                    <div class="chips chips-wrap">
              <span class="chip-toggle">
                <input type="checkbox" id="cat-incendio" name="categoria[]" value="Incendio forestal">
                <label for="cat-incendio" class="chip">Incendio forestal</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="cat-derrumbe" name="categoria[]" value="Derrumbe de cerro">
                <label for="cat-derrumbe" class="chip">Derrumbe de cerro</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="cat-terremoto" name="categoria[]" value="Terremoto">
                <label for="cat-terremoto" class="chip">Terremoto</label>
              </span>

                        <a class="chip mas" href="#cat-modal">+ M√°s</a>
                    </div>
                    <p class="help info">Seleccion√° una o varias categor√≠as.</p>
                </div>
            </details>

            <!-- FECHA -->
            <details class="flt">
                <summary class="flt-head">
                    <span class="flt-title">Fecha</span>
                    <span class="caret" aria-hidden="true">‚ñæ</span>
                </summary>

                <div class="flt-body">
                    <div class="date-range">
                        <div>
                            <span>Desde</span>
                            <input type="date" name="fecha_desde"/>
                        </div>
                        <div>
                            <span>Hasta</span>
                            <input type="date" name="fecha_hasta"/>
                        </div>
                    </div>
                </div>
            </details>

            <!-- UBICACI√ìN -->
            <details class="flt">
                <summary class="flt-head">
                    <span class="flt-title">Ubicaci√≥n</span>
                    <span class="caret" aria-hidden="true">‚ñæ</span>
                </summary>

                <div class="flt-body">
                    <div class="ubic-searchbar">
                        <input id="ubic-search" name="ubicacion_text" type="search" placeholder="Buscar ubicaci√≥n‚Ä¶"
                               list="ubic-sugeridas" autocomplete="off">
                        <datalist id="ubic-sugeridas">
                            <option value="CABA">
                            <option value="Ciudad de C√≥rdoba">
                            <option value="Rosario">
                            <option value="Paran√°, Entre R√≠os">
                            <option value="Mendoza">
                            <option value="San Juan">
                            <option value="Neuqu√©n">
                        </datalist>
                    </div>

                    <div class="chips chips-wrap">
              <span class="chip-toggle">
                <input type="checkbox" id="u-caba" name="ubicacion[]" value="CABA">
                <label for="u-caba" class="chip">CABA</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="u-parana" name="ubicacion[]" value="Paran√°, Entre R√≠os">
                <label for="u-parana" class="chip">Paran√°, Entre R√≠os</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="u-rosario" name="ubicacion[]" value="Rosario">
                <label for="u-rosario" class="chip">Rosario</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="u-mendoza" name="ubicacion[]" value="Mendoza">
                <label for="u-mendoza" class="chip">Mendoza</label>
              </span>
                    </div>

                    <p class="help info">
                        Escrib√≠ para sugerencias; tild√°/destild√° chips para sumar o quitar.
                    </p>
                </div>
            </details>

            <!-- FUENTE -->
            <details class="flt">
                <summary class="flt-head">
                    <span class="flt-title">Fuente</span>
                    <span class="caret" aria-hidden="true">‚ñæ</span>
                </summary>

                <div class="flt-body">
                    <div class="chips chips-wrap">
              <span class="chip-toggle">
                <input type="checkbox" id="f-estatica" name="fuente[]" value="estatica">
                <label for="f-estatica" class="chip">Est√°tica</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="f-dinamica" name="fuente[]" value="dinamica">
                <label for="f-dinamica" class="chip">Din√°mica</label>
              </span>
                        <span class="chip-toggle">
                <input type="checkbox" id="f-proxy" name="fuente[]" value="proxy">
                <label for="f-proxy" class="chip">Proxy</label>
              </span>
                    </div>
                </div>
            </details>

            <!-- Acciones -->
            <div class="filters-actions">
                <button type="reset" class="btn-clean">Limpiar filtros</button>
                <button type="submit" class="btn-apply">Aplicar</button>
            </div>

        </form>
    </aside>


    <!-- Feed central (√∫nico con scroll) -->
    <section class="feed">
        <!-- Share (sin JS): expansible con details/summary -->
        <details class="share">
            <summary id="shareSummary" class="card post-box" role="button" aria-controls="sharePanel">
                <input type="text" placeholder="Comparte tus hechos..." readonly/>
                <div class="post-icons" aria-hidden="true">
                    <a href="#modal-media" class="post-icon" aria-label="Adjuntar imagen"
                       onclick="event.stopPropagation()">
                        <img src="../shared/assets/icons/imagesmode.svg" alt="">
                    </a>
                    <button type="button" class="post-icon" aria-label="Insertar emoji"
                            onclick="event.stopPropagation()">
                        <img src="../shared/assets/icons/sentiment_satisfied.svg" alt="">
                    </button>
                </div>
            </summary>


            <form id="sharePanel" class="share-panel" method="post" action="" novalidate>
                <div class="share-row">
                    <div class="field">
                        <label for="titulo">T√≠tulo del Hecho</label>
                        <input id="titulo" name="titulo" type="text" placeholder="T√≠tulo del Hecho" required/>
                        <p class="help error-msg">El t√≠tulo es obligatorio.</p>
                    </div>

                    <div class="field">
                        <label for="fecha">Fecha</label>
                        <input id="fecha" name="fecha" type="date" required/>
                        <p class="help error-msg">Seleccion√° una fecha v√°lida.</p>
                    </div>

                    <div class="field">
                        <label for="descripcion">Descripci√≥n</label>
                        <div class="textarea-wrap">
                <textarea id="descripcion" name="descripcion" rows="5" placeholder="Describe lo ocurrido‚Ä¶"
                          required></textarea>

                        </div>
                        <p class="help error-msg">La descripci√≥n es obligatoria.</p>
                        <p class="help info">Evit√° datos personales. S√© claro y espec√≠fico.</p>
                    </div>


                    <div class="share-actions">
                        <div class="left-actions">
                            <!-- Categor√≠a: look & feel de Colecciones -->
                            <div class="field field-inline">
                                <label for="sh-categoria">Categor√≠a</label>
                                <div class="select select-share">
                                    <select id="sh-categoria" name="categoria" required aria-label="Categor√≠a">
                                        <option value="">Selecciona una categor√≠a</option>
                                        <option>Desastre Natural</option>
                                        <option>Medio Ambiente</option>
                                        <option>Derechos Humanos</option>
                                        <!-- agrega las tuyas -->
                                    </select>
                                    <img src="../shared/assets/icons/chevron-down.svg" alt="" class="select-caret"
                                         aria-hidden="true">
                                </div>
                                <p class="help error-msg">Eleg√≠ una categor√≠a.</p>
                            </div>

                            <!-- Ubicaci√≥n con icono -->
                            <a class="btn chip icon-left" href="#modal-ubicacion">
                                <img class="icon" src="../shared/assets/icons/location-pin-svgrepo-com.svg" alt=""
                                     aria-hidden="true">
                                Ubicaci√≥n
                            </a>
                        </div>

                        <div class="right-actions">
                            <button type="reset" class="btn ghost small">Limpiar</button>
                            <a href="#shareSuccess" class="btn primary small submit-btn">Enviar</a>
                        </div>

                    </div>
            </form>
        </details>


        <!-- Hecho 1 -->
        <article class="hecho card">
            <a class="flag-float" href="#report-hecho-1" aria-label="Reportar este hecho">
                <img src="../shared/assets/icons/ci_flag.svg" alt="" class="icon-img">
            </a>
            <span class="tag">Estallido de gasoducto</span>
            <h2>Impacto de Estallido de gasoducto en comunidad de Paran√°, Entre R√≠os</h2>
            <p class="ubicacion">Paran√°, Entre R√≠os | 5 May 2025</p>
            <p>Un grave estallido de gasoducto se registr√≥ en Paran√°, Entre R√≠os. El incidente oblig√≥ a evacuar a
                residentes
                de la zona. Se ha iniciado una investigaci√≥n para determinar las causas exactas del incidente.</p>
            <img src="https://images.unsplash.com/photo-1520975922284-7b683d5a5f0d?q=80&w=1400&auto=format&fit=crop"
                 alt="Incidente"/>
            <p class="fuente">Static ‚Ä¢ Nombre de la fuente</p>
        </article>

        <!-- Hecho 2 -->
        <article class="hecho card">
            <a class="flag-float" href="#report-hecho-1" aria-label="Reportar este hecho">
                <img src="../shared/assets/icons/ci_flag.svg" alt="" class="icon-img">
            </a>
            <span class="tag">Estallido de gasoducto</span>
            <h2>Otro hecho de ejemplo</h2>
            <p class="ubicacion">Paran√°, Entre R√≠os | 6 May 2025</p>
            <p>Descripci√≥n del hecho para completar el feed y probar el scroll interno de la columna central.</p>
            <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=1400&auto=format&fit=crop"
                 alt="Incidente"/>
            <p class="fuente">Static ‚Ä¢ Nombre de la fuente</p>
        </article>
    </section>

    <!-- Sidebar derecha -->
    <aside class="sidebar-right">
        <div class="card map-box">
            <h3>Mapa</h3>
            <div class="map-frame">
                <div id="map" data-mm-map></div>

            </div>
        </div>

        <div class="card colecciones">
            <h3>Colecciones</h3>
            <ul>
                <li><a href="#">Desastres naturales <span>CURADO</span></a></li>
                <li><a href="#">Caridad <span>NO CURADO</span></a></li>
                <li><a href="#">San Juan <span>CURADO</span></a></li>
            </ul>
            <button class="explorar">Explorar Mas</button>
        </div>
    </aside>
</main>

<!-- Modal auth -->
<!-- Overlay Modal -->
<div id="authOverlay" hidden>
    <div class="auth-modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
        <button id="authClose" class="auth-close" aria-label="Cerrar">‚úï</button>

        <!-- Login -->
        <section id="loginPanel">
            <h3 id="authTitle">Iniciar sesi√≥n</h3>
            <form id="loginForm" novalidate>
                <input type="email" placeholder="Email" required>
                <input type="password" placeholder="Contrase√±a" required>
                <button type="submit">Entrar</button>
            </form>
            <p>¬øNo ten√©s cuenta? <a href="#" id="toggleRegister">Crear una</a></p>
        </section>

        <!-- Registro -->
        <section id="registerPanel" hidden>
            <h3>Crear cuenta</h3>
            <form id="registerForm" novalidate>
                <div class="grid-2">
                    <label class="field">
                        <span>Primer nombre <b class="req">*</b></span>
                        <input id="firstName" name="firstName" type="text" placeholder="Tu primer nombre"
                               autocomplete="given-name" required minlength="2">
                    </label>
                    <label class="field">
                        <span>Apellido <b class="req">*</b></span>
                        <input id="lastName" name="lastName" type="text" placeholder="Tu apellido"
                               autocomplete="family-name"
                               required minlength="2">
                    </label>
                </div>

                <label class="field">
                    <span>Email <b class="req">*</b></span>
                    <input id="regEmail" name="email" type="email" placeholder="nombre@ejemplo.com" required
                           autocomplete="email">
                </label>

                <label class="field">
                    <span>Contrase√±a <b class="req">*</b></span>
                    <input id="regPass" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                           autocomplete="new-password" minlength="6">
                </label>

                <button type="submit">Registrarme</button>
            </form>
            <p>¬øYa ten√©s cuenta? <a href="#" id="toggleLogin">Iniciar sesi√≥n</a></p>
        </section>
    </div>
</div>

<!-- Pop-up de √©xito -->
<div id="shareSuccess" class="modal-overlay target-modal">
    <div class="modal auth-modal" role="dialog" aria-modal="true" aria-labelledby="shareSuccessTitle">
        <a href="#" class="modal-close" aria-label="Cerrar">√ó</a>
        <h2 id="shareSuccessTitle">¬°Tu hecho se public√≥ con √©xito! üéâ</h2>
        <p class="muted">
            Tu aporte ya es visible para toda la comunidad.
            <br>
            ¬øQuieres poder <strong>editarlo o gestionarlo durante 7 d√≠as</strong>?
            <a href="#authOverlay" style="color: var(--ui-blue); font-weight: 600;">Crea tu cuenta</a> y desbloquea m√°s
            funciones.
        </p>
        <a class="primary" href="#"
           style="display:inline-block; margin-top:.5rem; padding:.6rem 1rem; border-radius:10px; text-decoration:none; background:var(--ui-blue); color:#fff; font-weight:600;">
            Entendido
        </a>
    </div>
</div>


<!-- Modal: Subir multimedia (CSS-only con :target) -->
<div id="modal-media" class="modal-overlay target-modal">
    <a href="#close" class="overlay-dismiss" aria-label="Cerrar"></a>
    <div class="modal auth-modal upload-modal" role="dialog" aria-modal="true" aria-labelledby="mediaTitle">

        <h2 id="mediaTitle">Adjuntar imagen</h2>
        <p class="muted">Pod√©s arrastrar una imagen aqu√≠ o seleccionarla desde tu dispositivo. Formatos: JPG, PNG, WebP.
        </p>

        <form class="upload-form" action="#" method="get" novalidate>
            <label for="mediaFile" class="dropzone" aria-describedby="mediaHelp">
                <span class="dz-icon" aria-hidden="true">üñºÔ∏è</span>
                <span class="dz-title">Arrastr√° y solt√° la imagen</span>
                <span class="dz-sub">o haz clic para explorar‚Ä¶</span>
                <input id="mediaFile" name="mediaFile" type="file" accept="image/*" required>
            </label>
            <p id="mediaHelp" class="help info">Tama√±o recomendado &lt; 5 MB. Evit√° datos personales o sensibles.</p>

            <div class="upload-actions">
                <a href="#close" class="btn ghost">Cancelar</a>
                <!-- Sin JS: este ‚ÄúAdjuntar‚Äù cierra el modal. Queda visualmente deshabilitado hasta que haya archivo -->
                <a href="#" class="btn primary submit-link">Adjuntar</a>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Solicitud de eliminaci√≥n (CSS-only con :target) -->
<div id="report-hecho-1" class="modal-overlay target-modal">
    <!-- Click en el fondo cierra -->
    <a href="#close" class="overlay-dismiss" aria-label="Cerrar"></a>

    <div class="modal auth-modal report-modal" role="dialog" aria-modal="true" aria-labelledby="reportTitle-1">
        <a href="#close" class="modal-close" aria-label="Cerrar">√ó</a>

        <h2 id="reportTitle-1">Solicitud de eliminaci√≥n</h2>
        <p class="muted">
            Explic√° por qu√© este contenido deber√≠a eliminarse.
            <strong>M√≠nimo 500 caracteres.</strong> No incluyas datos personales.
        </p>

        <form class="report-form" action="#" method="post" novalidate>
            <label class="field">
                <span class="sr-only">Justificaci√≥n</span>
                <textarea id="justificacion-1" name="justificacion" placeholder="Justificaci√≥n (m√≠n. 500 caracteres)"
                          minlength="500" required rows="8"></textarea>
                <p class="help info">Escribe una justificaci√≥n clara y verificable. Evit√° datos sensibles.</p>
                <p class="help error-msg">La justificaci√≥n debe tener al menos 500 caracteres.</p>
            </label>

            <div class="upload-actions">
                <a href="#close" class="btn ghost">Cancelar</a>
                <!-- Deshabilitado visualmente hasta que textarea sea v√°lido (CSS-only) -->
                <button type="submit" class="btn primary submit-report" formaction="#reportSuccess" formmethod="get"
                        disabled>
                    Enviar solicitud
                </button>

            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmaci√≥n DR-->
<div id="reportSuccess" class="modal-overlay target-modal">
    <a href="#close" class="overlay-dismiss" aria-label="Cerrar"></a>

    <div class="modal auth-modal success-modal" role="dialog" aria-modal="true" aria-labelledby="successTitle">
        <a href="#close" class="modal-close" aria-label="Cerrar">√ó</a>

        <h2 id="successTitle">Solicitud en revisi√≥n</h2>
        <p class="muted">
            ¬°Gracias por colaborar con la comunidad! Revisaremos tu solicitud y
            actuaremos de acuerdo con las normas de convivencia para mantener MetaMapa
            √∫til, seguro y respetuoso para todas las personas.
        </p>

        <a href="#close" class="btn primary" style="margin-top:.5rem;">Entendido</a>
    </div>
</div>

<!-- =============== MODAL +M√ÅS CATEGOR√çAS (embebido en el form) =============== -->
<div id="cat-modal" class="modal-overlay target-modal">
    <a href="#close" class="overlay-dismiss" aria-label="Cerrar"></a>

    <div class="modal auth-modal" role="dialog" aria-modal="true" aria-labelledby="catModalTitle">
        <a href="#close" class="modal-close" aria-label="Cerrar">√ó</a>
        <h2 id="catModalTitle">Seleccionar m√°s categor√≠as</h2>

        <!-- Buscador opcional (el backend puede usar cat_q) -->
        <label class="field" style="margin-bottom:.5rem;">
            <span class="sr-only">Buscar categor√≠a</span>
            <input type="search" name="cat_q" placeholder="Buscar categor√≠a‚Ä¶">
        </label>

        <!-- Grid de categor√≠as adicionales (mismo name para sumarse al submit) -->
        <div class="chips chips-grid" style="margin-bottom:.75rem;">
        <span class="chip-toggle">
          <input type="checkbox" id="cat-tsunami" name="categoria[]" value="Tsunami">
          <label for="cat-tsunami" class="chip">Tsunami</label>
        </span>
            <span class="chip-toggle">
          <input type="checkbox" id="cat-inundacion" name="categoria[]" value="Inundaci√≥n">
          <label for="cat-inundacion" class="chip">Inundaci√≥n</label>
        </span>
            <span class="chip-toggle">
          <input type="checkbox" id="cat-contaminacion" name="categoria[]" value="Contaminaci√≥n">
          <label for="cat-contaminacion" class="chip">Contaminaci√≥n</label>
        </span>
            <span class="chip-toggle">
          <input type="checkbox" id="cat-ddhh" name="categoria[]" value="Derechos Humanos">
          <label for="cat-ddhh" class="chip">Derechos Humanos</label>
        </span>
            <!-- agregar mas... -->
        </div>

        <div class="upload-actions">
            <a href="#close" class="btn ghost">Cerrar</a>
            <!-- Este "Aplicar" env√≠a el MISMO form por GET (sin JS) -->
            <button type="submit" class="btn primary">Aplicar</button>
        </div>
    </div>
</div>
<!-- ========================================================================== -->


<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Scripts propios -->
<script src="layout.js"></script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="../shared/Map/map.js"></script>

<script src="auth.js"></script>

<script>
    document.addEventListener('input', (e) => {
        const ta = e.target.closest('textarea[minlength]');
        if (!ta) return;
        const form = ta.closest('form');
        const submit = form?.querySelector('.submit-report');
        if (!submit) return;

        const min = parseInt(ta.getAttribute('minlength') || '500', 10);
        const ok = ta.value.trim().length >= min;
        submit.disabled = !ok;
    });
</script>


</body>

</html>